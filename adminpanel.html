<!doctype html>
<div class="row">
<input id="slug" placeholder="slug (z. B. yt)" />
<input id="target" placeholder="https://example.com" style="flex:1" />
<button id="create" class="btn">Erstellen</button>
</div>


<table>
<thead><tr><th>Slug</th><th>Ziel</th><th>Hits</th><th>Heute</th><th>Link</th><th></th></tr></thead>
<tbody id="list"></tbody>
</table>


<button id="logout" class="btn">Logout</button>
</div>
</div>


<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
import { getFirestore, doc, setDoc, deleteDoc, onSnapshot, collection } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';


const firebaseConfig = {
  apiKey: "AIzaSyDIY2V8GZOqdn7yw10-UBvendRFpfiZi-s",
  authDomain: "afs-link-web.firebaseapp.com",
  projectId: "afs-link-web",
  storageBucket: "afs-link-web.firebasestorage.app",
  messagingSenderId: "304806686418",
  appId: "1:304806686418:web:d1ec3072745976368b870b",
  measurementId: "G-EGTNRRV3JM"
};


const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);


const login = document.getElementById('login');
const panel = document.getElementById('panel');
const list = document.getElementById('list');


document.getElementById('loginBtn').onclick = () => {
signInWithEmailAndPassword(auth, email.value, password.value)
.catch(e=>alert(e.message));
};


onAuthStateChanged(auth, async user=>{
if (!user){ login.style.display='block'; panel.style.display='none'; return; }
login.style.display='none';
panel.style.display='block';
load();
});


function load(){
const today = new Date().toISOString().slice(0,10);
onSnapshot(collection(db,'shorturls'), snap=>{
list.innerHTML='';
snap.forEach(d=>{
const data = d.data();
const tr=document.createElement('tr');
const shortUrl = location.origin + location.pathname.replace('adminpanel.html','') + `?r=${d.id}`;
tr.innerHTML=`
<td>${d.id}</td>
<td>${data.target}</td>
<td>${data.hits||0}</td>
<td>${data.daily?.[today]||0}</td>
<td><button class="btn copy">Kopieren</button></td>
<td><button class="danger">X</button></td>`;
tr.querySelector('.danger').onclick=()=>deleteDoc(doc(db,'shorturls',d.id));
tr.querySelector('.copy').onclick=()=>{
navigator.clipboard.writeText(shortUrl);
alert('Kopiert: ' + shortUrl);
};
list.appendChild(tr);
});
});
}


document.getElementById('create').onclick = async ()=>{
if(!slug.value||!target.value)return;
await setDoc(doc(db,'shorturls',slug.value),{target:target.value,hits:0,daily:{}});
slug.value=''; target.value='';
};


document.getElementById('logout').onclick=()=>signOut(auth);
</script>
</body>
</html>